// npx prisma migrate reset
// npx prisma migrate dev --name <name>

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/*
 * User Model
 */

enum UserRoleEnum  {
  CUSTOMER
  MANAGER
}

model User {
  id                    String            @id             @default(uuid()) 
  username              String            @unique         @db.VarChar(30)                  
  password              String            
  name                  String          
  role                  UserRoleEnum
  account               Account?          
  createdDate           DateTime          @default(now())
  updatedDate           DateTime          @updatedAt

  @@index([name, role, createdDate])
}

/*
 * Account Model
 */

model Account {
  id                    String            @id             @default(uuid()) 
  balance               Float             @default(0)
  userId                String            @unique
  user                  User              @relation(fields: [userId], references: [id])
  sentTransactions      Transaction[]     @relation("SentTransactions")
  receivedTransactions  Transaction[]     @relation("ReceivedTransactions")
}

/*
 * Transaction Model
 */

enum TransactionTypeEnum {
  DEPOSIT
  WITHDRAW
  TRANSFER
}

model Transaction {
  id                    String            @id             @default(uuid())
  type                  TransactionTypeEnum
  amount                Float
  sentAccountId         String
  sentAccount           Account           @relation("SentTransactions", fields: [sentAccountId], references: [id])
  receivedAccountId     String?
  receivedAccount       Account?          @relation("ReceivedTransactions", fields: [receivedAccountId], references: [id])
  createdDate           DateTime          @default(now())

  @@index([amount, type, createdDate])
}